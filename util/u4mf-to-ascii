#!/usr/local/bin/sbcl --script
;; Convert text strings in U4-memory-format to ASCII. Reads from stdin, writes to stdout.
;;
;; Example:  ./u4mf-to-ascii < vice-memory-dump.vsf | strings

(do ((c (read-byte *STANDARD-INPUT*) (read-byte *STANDARD-INPUT*)))
    ((null c))
  (write-byte 
   (cond 
     ;; A..Z
     ((and (>= c #xC1)
	  (<= c #xDA))
      (+ (char-code #\A) (- c #xC1)))
     ;; a..z
     ((and (>= c #xE1)
	   (<= c #xFA))
      (+ (char-code #\a) (- c #xE1)))

     ((= c #xBF) (char-code #\?))  ;; ?
     ((= c #xAE) (char-code #\.))  ;; .

     (t c))
   *STANDARD-OUTPUT*))
    
;(loop (write-char (read-char *STANDARD-INPUT*) *STANDARD-OUTPUT*))